{% extends "layout.html" %}

{% block title %}Cào dữ liệu - Real-time{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-4">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0"><i class="bi bi-folder2-open"></i> Thư mục đã cào</h5>
                <button id="reloadTreeBtn" class="btn btn-sm btn-outline-light" title="Tải lại cây thư mục">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>
            </div>
            <div id="folderTree" class="tree-container p-2" style="max-height: 300px;">
                </div>
        </div>

        <div class="card shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
                 <h5 class="card-title mb-0"><i class="bi bi-clock-history"></i> Lịch sử cào</h5>
                 <button id="reloadHistoryBtn" class="btn btn-sm btn-outline-secondary" title="Tải lại lịch sử">
                    <i class="bi bi-arrow-clockwise"></i>
                </button>
            </div>
            <div id="crawled-users-list" class="list-group list-group-flush" style="max-height: 400px; overflow-y: auto;">
                </div>
        </div>
    </div>

    <div class="col-lg-8">
        <div class="card shadow-sm mb-4">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-cloud-download"></i> Cào dữ liệu từ Mạng xã hội</h5>
            </div>
            <div class="card-body">
                <form id="scraper-form">
                    <div class="row align-items-end">
                        <div class="col-md-5 mb-3 mb-md-0">
                            <label for="platformSelect" class="form-label">Nền tảng</label>
                            <select class="form-select" id="platformSelect" name="platform" required>
                                <option value="instagram">Instagram</option>
                                <option value="threads">Threads</option>
                                <option value="facebook">Facebook</option>
                            </select>
                        </div>
                        <div class="col-md-5 mb-3 mb-md-0">
                            <label for="usernameInput" class="form-label">Tên người dùng (Username)</label>
                            <input type="text" class="form-control" id="usernameInput" name="username" placeholder="ví dụ: nasa" required>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" id="start-scrape-btn" class="btn btn-primary w-100">
                                Cào
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div id="progress-container" class="card shadow-sm" style="display: none;">
            <div class="card-header bg-white">
                 <h5 class="card-title mb-0">Tiến trình</h5>
            </div>
            <div class="card-body">
                <div id="profile-info" class="text-center border-bottom pb-3 mb-3" style="display: none;">
                    <img id="profile-pic" src="https://placehold.co/80x80/eee/ccc?text=?" class="rounded-circle mb-2" alt="Profile Picture" style="width: 80px; height: 80px;">
                    <h6 id="profile-name" class="mb-0"></h6>
                    <small id="profile-id" class="text-muted"></small>
                </div>
                
                <div class="d-flex justify-content-between align-items-center mb-1">
                    <p id="progress-status" class="mb-0 text-muted"></p>
                    <p id="progress-count" class="mb-0 fw-bold"></p>
                </div>
                <div class="progress" style="height: 10px;">
                    <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%;"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='script.js') }}" type="module"></script> 
<script src="{{ url_for('static', filename='scraper_progress.js') }}"></script>
{% endblock %}